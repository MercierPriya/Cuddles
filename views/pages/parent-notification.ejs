<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/parent-notification.css">
    <title><%= parent.name %> notifications</title>
</head>
<body>
    <div class="wrapper">
    <!-- navbar imported from partials -->
    <%- include('../partials/parent-navbar') %>

    <h2>üìå Notifications & R√©servations</h2>
<!-- Notifications g√©n√©rales -->
<% if (notifications.length > 0) { %>
<ul class="notification-list">
    <% notifications.forEach((notification ,index)=> { %>
   <li class="notification-item <%= notification.isRead ? 'read' : '' %>" 
    data-notification-id="<%= notification._id %>">


            <p><%= notification.message %></p>
            <% if (notification.link) { %>
                <a href="<%= notification.link %>">Voir le profil</a>
                <p><%= notification.date %></p>
            <% } %>
        </li>
    <% }); %>
</ul>
<% } else { %>
    <p class="empty-message">Aucune notification</p>
<% } %>

<!-- Liste des r√©servations faites par le parent -->
<h3>üìÖ Vos demandes de r√©servation</h3>
<% if (reservations.length > 0) { %>
<ul class="reservation-list">
    <% reservations.forEach(reservation => { %>
     <li class="reservation-item 
    <%= reservation.status === 'confirmed' ? 'status-confirmed' : 
        reservation.status === 'rejected' ? 'status-rejected' : 'status-pending' %>">

            <strong>Babysitter :</strong> 
            <a href="/babysitter-details/<%= reservation.babysitterId._id %>">
                <%= reservation.babysitterId.name %>
            </a> <br>
            <strong>Enfants :</strong> 
            <% reservation.childDetails.forEach(child => { %>
                <span><%= child.name %> (√Çge: <%= child.age %>)</span>
            <% }) %> <br>
            <strong>Date :</strong> 
            <%= new Date(reservation.startDate).toLocaleDateString('fr-FR') %> - 
            <%= new Date(reservation.endDate).toLocaleDateString('fr-FR') %> <br>
            <strong>Contact:</strong>
            <%= reservation.babysitterId.phone %><br>
            <strong>Statut :</strong> 
            <% if (reservation.status === 'pending') { %>
                ‚è≥ En attente
            <% } else if (reservation.status === 'confirmed') { %>
                ‚úÖ Accept√©e
            <% } else { %>
                ‚ùå Rejet√©e
            <% } %>
        </li>
    <% }) %>
</ul>
<% } else { %>
    <p class="empty-message">Aucune r√©servation faite</p>
<% } %>
<%- include('../partials/simple-footer') %>
</div>
</body>

<script>
    const notificationItems = document.querySelectorAll('.notification-item');

    notificationItems.forEach(item => {
        item.addEventListener('click', async () => {
            const notificationId = item.getAttribute('data-notification-id');  // Get the notification ID from the HTML
            const parentId = '<%= parent._id %>';  // Parent ID from EJS

            if (notificationId) {
                // Send an API request to mark the notification as read
                fetch(`/parents/${parentId}/notifications/${notificationId}/mark-as-read`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Notification marked as read:', data);
                    // Update UI to show it as read
                    item.style.opacity = 0.5;
                })
                .catch(error => {
                    console.error('Error marking notification as read:', error);
                });
            }
        });
    });
</script>


</html>

